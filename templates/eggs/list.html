<!DOCTYPE html>
<html>
<head>
    <title>チェレンジ一覧</title>
    <META name="keywords" content="cheer challeng">
    <META name="description" content="hatch will make your dream come true!">
    <script src="{{ url_for('static', filename='js/jquery.js') }}" type="text/javascript"></script>
    <script src="{{ url_for('static', filename='js/jquery-1.7.2.min.js') }}" type="text/javascript"></script>
    <script src="{{ url_for('static', filename='js/jquery.jrumble.1.3.min.js') }}" type="text/javascript"></script> 
    <script src="{{ url_for('static', filename='js/prettify.js') }}" type="text/javascript"></script>
    <script src="{{ url_for('static', filename='js/test.js') }}" type="text/javascript"></script>
    <link href="{{ url_for('static', filename='css/bootstrap.css') }}" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}" type="text/css" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/prettify.css') }}" type="text/css" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/jquery.nBox.css') }}" type="text/css" >
    <script src="{{ url_for('static', filename='js/jquery.nBox.js') }}"></script>
    <style>
    .container { width: 940px; margin: 0 auto;}
.grid1, .grid2, .grid3, .grid4, .grid5, .grid6, .grid7, .grid8, .grid9, .grid10, .grid11 {
  float: left;
  display: inline;
  margin-left: 20px;
}
.grid1 {width: 60px;}
.grid2 {width: 140px;}
.grid3 {width: 220px;}
.grid4 {width: 300px;}
.grid5 {width: 380px;}
.grid6 {width: 460px;}
.grid7 {width: 540px;}
.grid8 {width: 620px;}
.grid9 {width: 700px;}
.grid10 {width: 780px;}
.grid11 {width: 860px;}
.first {margin-left: 0;clear: left;}
/* clearfix */
.clearfix:after {
  visibility: hidden;
  display: block;
  font-size: 0;
  content: " ";
  clear: both;
  height: 0;
}

      body {
        padding-top: 60px; /* 60px to make the container go all the way to the bottom of the topbar */
      }
      #grid {
    width: 450px;
    }
    li {
        margin: 5px;
        float: left;
        list-style: none;
    }
    </style>
    <script type="text/javascript">
    $(function(){
        for (var i=0; i <=10; i++) {
            var myButton = $('#my-button-' + (i).toString(10));
            var myBox = $('#my-box-' + (i).toString(10));
            myButton.nBox({
                targetId:'my-box-' + (i).toString(10),
                width:300,
                height:150
            });
            myBox.click(function(){
                myButton.nBox('hide');
            });
        }

    });
    function get_amazon_html(index,title){
        return "<p><input type='radio' name='amazon' value='"+index+"'>"+title+"</p>"
    }
    var selected_amazon_items = [];
    function create_parameter(index){
        var item = selected_amazon_items[index];
        return "&title="+item.title+"&price="+item.price+"&thumbnail="+item.thumbnail+
                "&detail_link="+item.thumbnail;
    }
    function amazon_get(){
        console.log("amazon_get");
        $('form[name=challenge]').submit(function(){
            console.log("amazon_get_submit");
            $.post("/promise/candidates", $(this).serialize(), function(json) {
                //for(var i = 0; i < json["candidates"].length; i++){
                for(var i = 0; i < json["candidates"].length && i < 5; i++){
                    var item = json["candidates"][i];
                    selected_amazon_items[i]=item;
                    $("#amason_candidate").append(get_amazon_html(i,item.title));
                }
                console.log("append to amason_list");
            }, 'json');
            return false;
        });
    };
    function form_submit(){
        console.log("form_submit");
        var val = $('#challenge [name=amazon]:checked').val();
        var form = $('form[name=challenge]');
        console.log("val =", val);
        console.log(form.serialize()+create_parameter(val));
        $.post("/eggs/generate", form.serialize()+create_parameter(val), function(json) {
            console.log("redirect");
            location.href="/";
        });
        return false;
    };

    </script>
    <link href="{{ url_for('static', filename='css/bootstrap-responsive.css') }}" rel="stylesheet">
</head>
<body>
<div>{{ session.user_name }}の友人のリスト</div>
<form id="challenge" name="challenge" action="{{ url_for('generate_egg') }}">
    何がしたい？
    <input type="text" name="challenge" size="140"><br>
    それって何が必要？
    <input type="text" name="keywords" size="30"><br>

    何人の後押しが必要？<br>
    <input type="number" name="do_when" value=20><br>
    <button  onclick="amazon_get();" >
        Amazon Get
    </button>

    成立したら
    <input type="text" name="promise" size="140">
    をする!
    <button onclick="form_submit();" >
        挑戦
    </button>
    <div id="amason_candidate">
    </div>
</form>

<div id="amazon_list">
    <div class="each-comment">
    </div>
    <div class="each-comment">
    </div>
    <div id="new-comment"></div>
</div>

<div class='container clearfix'>
{% for egg in eggs %}
{% if egg.index % 3 == 0 %}
<div class="grid3 first">
{% else %}
<div class="grid4">
{% endif %}
    <img src="{{ url_for('static', filename='resource/egg.png') }}" type="button" value="show!" id="my-button-{{egg.index}}"{ class='vibrate' width="98" height="133">
    <div id="my-box-{{egg.index}}">
        <div>
        所有者：<div>{{ egg.owner_name }} {{egg.index}}</div>
        何に挑戦する？:<div>{{ egg.challenge }}</div>
        成立したら？：<div>{{ egg.promise }}</div>
        今 {{ egg.cheered }}/{{ egg.do_when }}</div>
        <div>
            <div>
    {% if not egg.is_own %}
        <form action="{{ url_for('cheer',egg_id=egg.egg_id) }}" method='post' >
        <input type="text" name="comment" size=70 placeholder="やってみろや！">
        {% if egg.already_cheered %}
            <input type="submit" value='応援した!' disabled>
        {% else %}
            <input type="submit" value='応援する!'>
        {% endif %}
        </form>
    {% endif %}
    </div>
        <div><button class="my-box-close"> 閉じる </button></div>
    </div>
</div>
    <!--<div>
    所有者：<div>{{ egg.owner_name }} {{egg.index}}</div>
    何に挑戦する？:<div>{{ egg.challenge }}</div>
    成立したら？：<div>{{ egg.promise }}</div>
    今 {{ egg.cheered }}/{{ egg.do_when }}</div>
    <div>
    {% if not egg.is_own %}
        <form action="{{ url_for('cheer',egg_id=egg.egg_id) }}" method='post' >
        <input type="text" name="comment" size=70 placeholder="やってみろや！">
        {% if egg.already_cheered %}
            <input type="submit" value='応援した!' disabled>
        {% else %}
            <input type="submit" value='応援する!'>
        {% endif %}
        </form>
    {% endif %}
    </div>-->
    
</div>
{% endfor %}
</div>
</body>
</html>